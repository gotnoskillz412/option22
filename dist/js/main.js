!function(e){function s(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}var t={};return s.m=e,s.c=t,s.p="",s(0)}([function(e,s,t){t(1),t(12),t(14),t(13),t(10),t(9),e.exports=t(8)},function(e,s,t){"use strict";var r=t(2),n=t(3),o=t(4),a=t(5),u=t(6),i=t(7),c=t(8),d=3e3,f=r(),l=process.env.MONGO_URI||"mongodb://localhost/option22";process.env.MY_SECRET="LordJeanLucSkywalker",f.use(n.json()),f.use(n.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),f.use(o()),f.use(u({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),f.use("/",c.index),f.use("/auth",c.auth),i.Promise=global.Promise,i.connect(l),f.use(function(e,s,t){var r=new Error("Not Found");r.status=404,t(r)}),"development"===f.get("env")&&f.use(function(e,s,t){t.status(e.status||500),t.render("error",{message:e.message,error:e})}),f.use(function(e,s,t){t.status(e.status||500),t.render("error",{message:e.message,error:{}})}),f.listen(d,function(){a.info("App listening on port "+d+"...")})},function(e,s){e.exports=require("express")},function(e,s){e.exports=require("body-parser")},function(e,s){e.exports=require("cookie-parser")},function(e,s){e.exports=require("winston")},function(e,s){e.exports=require("express-session")},function(e,s){e.exports=require("mongoose")},function(e,s,t){"use strict";s=e.exports={index:t(9),auth:t(10)}},function(e,s,t){"use strict";var r=t(2),n=r.Router();n.get("/",function(e,s){s.status(200).send("ok")}),s=e.exports=n},function(e,s,t){"use strict";var r=t(2),n=r.Router(),o=t(5),a=t(11),u=t(12),i=t(13),c=t(14);n.post("/register",function(e,s){var t=e.body.username.toLowerCase(),r=e.body.email.toLowerCase();i.findOne({email:r},function(n,a){n?s.status(500).json({message:"Error registering"}):a?s.status(400).json({message:"An account with this email already exists"}):i.findOne({username:t},function(n,a){if(n)s.status(500).json({message:"Error registering"});else if(a)s.status(400).json({message:"This username is already taken"});else{var u=e.body.password,d=c.generateSaltAndHash(u),f=new i({username:t,email:r,salt:d.salt,hash:d.hash});f.save(function(e){e?(o.error(e),s.status(500).json({message:"Problem creating new account"})):(o.info("Succressfull created acount for: ",r),s.status(201).json({success:"ok"}))})}})})}),n.post("/login",function(e,s){var t=e.body.username.toLowerCase(),r=e.body.password;i.findOne({username:t},function(e,t){if(e)s.status(400).json({message:"Incorrect username or password"});else if(t&&c.verifyPassword(r,t.salt,t.hash)){var n=a.sign({exp:Math.floor(Date.now()/1e3)+360,data:t.username},process.env.MY_SECRET);o.info("login success"),s.status(200).json({token:n})}else s.status(401).json({message:"Incorrect username or password"})})}),n.get("/logout",function(e,s){s.redirect("/")}),n.get("/test",u(),function(e,s){s.status(200).send("ok")}),s=e.exports=n},function(e,s){e.exports=require("jsonwebtoken")},function(e,s,t){"use strict";var r=t(11),n=function(){return function(e,s,t){var n=e.headers.authorization&&e.headers.authorization.split(" ");n=n&&2===n.length&&"bearer"===n[0].toLowerCase()?n[1]:null,n?r.verify(n,process.env.MY_SECRET,function(r,n){r?s.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=n,t())}):s.status(401).json({message:"Unauthorized: No token provided"})}};s=e.exports=n},function(e,s,t){"use strict";var r=t(7),n=r.Schema,o=new n({username:String,email:String,salt:String,hash:String});s=e.exports=r.model("Account",o)},function(e,s,t){"use strict";var r=t(15),n=32,o=function(e){return r.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},a=function(e,s){var t=r.createHmac("sha512",s);return t.update(e),t.digest("hex")},u=function(e){var s=o(n),t=a(e,s);return{salt:s,hash:t}},i=function(e,s,t){return a(e,s)===t};s=e.exports={generateSaltAndHash:u,verifyPassword:i}},function(e,s){e.exports=require("crypto")}]);