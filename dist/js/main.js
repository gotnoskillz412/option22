!function(e){function o(t){if(n[t])return n[t].exports;var r=n[t]={exports:{},id:t,loaded:!1};return e[t].call(r.exports,r,r.exports,o),r.loaded=!0,r.exports}var n={};o.m=e,o.c=n,o.p="",o(0)}([function(e,o,n){n(1),n(11),n(12),n(14),n(15),n(30),n(8),n(24),n(18),n(25),n(29),n(17),n(27),n(16),n(22),n(20),e.exports=n(9)},function(e,o,n){"use strict";var t=n(2),r=n(3),s=n(4),a=n(5),i=n(6),u=n(7),c=n(8),l=n(9),f=n(16),d=n(24),m=parseInt(process.env.API_PORT,10)||3e3,p={origin:process.env.BASE_WEB||"*",credentials:!0,optionsSuccessStatus:200},g=a();g.use(t.json()),g.use(t.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),g.use(r()),g.use(i({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),g.use(s(p)),g.use("/",f.index),g.use("/auth",f.auth),g.use("/email",f.email),g.use("/accounts/:accountId/goals",d(),c(),f.goals),g.use("/accounts/:accountId/profiles",d(),c(),f.profile),u.Promise=global.Promise,u.connect(process.env.MONGO_URI),g.use(function(e,o,n){var t=new Error("Not Found");t.status=404,n(t)}),"development"===g.get("env")&&g.use(function(e,o,n){n.status(e.status||500)}),g.use(function(e,o,n){n.status(e.status||500)}),g.listen(m,function(){l.info("app.js","App listening on port "+m+"...")}),e.exports=g},function(e,o){e.exports=require("body-parser")},function(e,o){e.exports=require("cookie-parser")},function(e,o){e.exports=require("cors")},function(e,o){e.exports=require("express")},function(e,o){e.exports=require("express-session")},function(e,o){e.exports=require("mongoose")},function(e,o,n){"use strict";var t=n(7),r=n(9),s=n(11),a=function(){return function(e,o,n){var a=e.params.accountId;t.Types.ObjectId.isValid(a)?s.findAccount({_id:a}).then(function(t){t?(e.account=t,n()):o.status(404).send()}).catch(function(e){r.error("accountExtractor","Error checking account",{error:e}),o.status(500).json({message:"Error finding account"})}):o.status(404).send()}};e.exports=a},function(e,o,n){"use strict";var t=n(10),r=new t.Logger({transports:[new t.transports.Console({colorize:!0,level:"silly",prettyPrint:!0,timestamp:!0}),new t.transports.File({colorize:!0,filename:"logs/log.txt",level:"info",timestamp:!0})]});r.emitErrs=!1,"test"===process.env.NODE_ENV&&(r.remove(t.transports.Console),r.remove(t.transports.File)),e.exports=r},function(e,o){e.exports=require("winston")},function(e,o,n){"use strict";var t=n(12),r=n(13),s=n(14),a=n(9),i=n(15),u=n(14),c=function(e){return new Promise(function(o,n){t.findOne(e,function(e,t){e?n({step:r.mongo.steps.accountFind,message:"Error finding account",error:e}):o(t)})})},l=function(e){return new Promise(function(o,n){new t(e).save(function(t,s){t?n({step:r.mongo.steps.accountCreate,message:"Error creating account",error:t}):(a.info("mongooseHelpers","Successfully created acount for: "+e.email),o(s))})})},f=function(e){return new Promise(function(o,n){t.remove(e,function(t,s){t?n({step:r.mongo.steps.accountDelete,message:"Error deleting account",error:t}):(a.info("mongooseHelpers","Successfully removed acount for: "+e.email),o(s))})})},d=function(e){return new Promise(function(o,n){new i(e).save(function(t,s){t?n({step:r.mongo.steps.profileCreate,message:"Error creating profile",error:t}):(a.info("mongooseHelpers","Successfully created profile for: "+e.email),o(s))})})},m=function(e){return new Promise(function(o,n){i.find(e,function(e,t){e?n({step:r.mongo.steps.profileFindAll,message:"Error finding profiles",error:e}):o(t)})})},p=function(e){return new Promise(function(o,n){i.findOne(e,function(e,t){e?n({step:r.mongo.steps.profileFind,message:"Error finding profile",error:e}):o(t)})})},g=function(e){return new Promise(function(o,n){i.remove(e,function(t,s){t?n({step:r.mongo.steps.profileDelete,message:"Error deleting profile",error:t}):(a.info("mongooseHelpers","Successfully removed profile for: "+e.email),o(s))})})},h=function(e){return new Promise(function(o,n){new s(e).add(function(t,s){t?n({step:r.mongo.steps.goalAdd,message:"Error adding goal",error:t}):(a.info("mongooseHelpers","Successfully goal for profile: "+e.profileId),o(s))})})},v=function(e){return new Promise(function(o,n){s.findOne(e,function(e,t){e?n({step:r.mongo.steps.goalFind,message:"Error finding goal",error:e}):o(t)})})},b=function(e){return new Promise(function(o,n){s.find(e,function(e,t){e?n({step:r.mongo.steps.goalFindAll,message:"Error finding goals",error:e}):o(t)})})},w=function(e){return new Promise(function(o,n){s.remove(e,function(e,t){e?n({step:r.mongo.steps.goalDelete,message:"Error deleting goal",error:e}):(a.info("mongooseHelpers","Successfully removed goal"),o(t))})})},y=function(e){return new Promise(function(o,n){new s(e).add(function(t,s){t?n({step:r.mongo.steps.subgoalAdd,message:"Error adding subgoal",error:t}):(a.info("mongooseHelpers","Successfully subgoal for goal: "+e.goalId),o(s))})})},x=function(e){return new Promise(function(o,n){u.findOne(e,function(e,t){e?n({step:r.mongo.steps.subgoalFind,message:"Error finding subgoal",error:e}):o(t)})})},E=function(e){return new Promise(function(o,n){u.find(e,function(e,t){e?n({step:r.mongo.steps.subgoalFindAll,message:"Error finding subgoals",error:e}):o(t)})})},j=function(e){return new Promise(function(o,n){u.remove(e,function(e,t){e?n({step:r.mongo.steps.subgoalDelete,message:"Error deleting subgoal",error:e}):(a.info("mongooseHelpers","Successfully removed subgoal"),o(t))})})};e.exports={findAccount:c,createAccount:l,removeAccount:f,createProfile:d,findProfile:p,findAllProfiles:m,removeProfile:g,addGoal:h,findGoal:v,findAllGoals:b,removeGoal:w,addSubgoal:y,findSubgoal:x,findAllSubgoals:E,removeSubgoal:j}},function(e,o,n){"use strict";var t=n(7),r=t.Schema,s=new r({email:String,hash:String,salt:String,username:String});e.exports=t.model("Account",s)},function(e,o){e.exports={mongo:{steps:{accountCreate:"account-create",accountDelete:"account-delete",accountFind:"account-find",goalAdd:"goal-add",goalFind:"goal-find",goalFindAll:"goal-find-all",goalDelete:"goal-delete",subgoalAdd:"sub-goal-add",subgoalFind:"sub-goal-find",subgoalFindAll:"sub-goal-find-all",subgoalDelete:"sub-goal-delete",profileCreate:"profile-create",profileDelete:"profile-delete",profileUpdate:"profile-update",profileFind:"profile-find",profileFindAll:"profile-find-all"}},blacklistPrefix:"option22-token-blacklist-"}},function(e,o,n){"use strict";var t=n(7),r=t.Schema,s=new r({profileId:r.Types.ObjectId,description:String,progress:Number,completed:Boolean});e.exports=t.model("Goal",s)},function(e,o,n){"use strict";var t=n(7),r=t.Schema,s=new r({accountId:r.Types.ObjectId,description:String,firstName:String,lastName:String,likes:[String],picture:String});e.exports=t.model("Profile",s)},function(e,o,n){"use strict";e.exports={index:n(17),auth:n(18),email:n(25),profile:n(27),goals:n(29)}},function(e,o,n){"use strict";var t=n(5),r=t.Router();r.get("/",function(e,o){o.status(200).json({ok:!0})}),e.exports=r},function(e,o,n){"use strict";var t=n(5),r=n(19),s=n(8),a=n(20),i=n(13),u=n(22),c=n(9),l=n(11),f=n(24),d=t.Router(),m=new RegExp("(?=^.{8,}$)((?=.*d)|(?=.*W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$"),p=new RegExp("^([a-zA-Z0-9_]{5,50})$");d.post("/register",function(e,o){var n=e.body.firstName||null,t=e.body.lastName||null,s=e.body.username.toLowerCase(),a=e.body.email.toLowerCase(),f=null;l.findAccount({email:a}).then(function(e){return e?Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that email already exists.",error:null}):l.findAccount({username:s})}).then(function(o){if(!o){var n=e.body.password;if(!n.match(m))return Promise.reject({step:i.mongo.steps.accountCreate,message:"Password did not meet requirements."});if(!s.match(p))return Promise.reject({step:i.mongo.steps.accountCreate,message:"Username must be alphanumeric and between 5 and 50 characters."});var t=u.generateSaltAndHash(n);return l.createAccount({username:s,email:a,salt:t.salt,hash:t.hash})}return Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that username already exists.",error:null})}).then(function(e){return f=e,l.createProfile({accountId:e._id,firstName:n,lastName:t})}).then(function(e){var n=r.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:s,email:a}},process.env.MY_SECRET);o.status(201).json({token:n,profile:e,account:{email:f.email,username:f.username,_id:f._id}})}).catch(function(e){e.step===i.mongo.steps.profileCreate?l.removeAccount({email:a}).then(function(){o.status(500).json({message:e.message})}):e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),o.status(500).json({message:e.message})):o.status(400).json({message:e.message})})}),d.post("/login",function(e,o){var n=e.body.username&&e.body.username.toLowerCase(),t=e.body.password,s=null;l.findAccount({username:n}).then(function(e){e&&u.verifyPassword(t,e.salt,e.hash)?(s=e,l.findProfile({accountId:s._id}).then(function(e){var t=r.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:n,email:s.email}},process.env.MY_SECRET);c.verbose("auth","Login successful",{email:s.email}),o.status(201).json({token:t,profile:e,account:{email:s.email,username:s.username,_id:s._id}})})):o.status(401).json({message:"Incorrect username or password"})}).catch(function(e){e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),o.status(500).json({message:e.message})):o.status(400).json({message:e.message})})}),d.get("/account",f(),function(e,o){l.findAccount({username:e.decoded.data.username}).then(function(e){e?l.findProfile({accountId:e._id}).then(function(n){n?o.status(200).json({account:{email:e.email,username:e.username,_id:e._id},profile:n}):o.status(500).json({message:"Failed to find profile"})}):o.status(500).json({message:"Failed to find account"})}).catch(function(e){e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),o.status(500).json({message:e.message})):o.status(400).json({message:e.message})})}),d.put("/account/:accountId/password",f(),s(),function(e,o){var n=e.body.newPassword,t=e.body.currentPassword;if(e.account&&u.verifyPassword(t,e.account.salt,e.account.hash)){var s=u.generateSaltAndHash(n);e.account.salt=s.salt,e.account.hash=s.hash;var a=r.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:e.account.username,email:e.account.email}},process.env.MY_SECRET);e.account.save(function(e,n){e?(c.error("auth","Failed to update password",{error:e}),o.status(500).json({message:"Failed to update password."})):o.status(200).json({token:a,account:{username:n.username,email:n.email,_id:n._id}})})}else o.status(400).json({message:"Incorrect password"})}),d.put("/account/:accountId/update",f(),s(),function(e,o){var n=e.body.username,t=e.body.email;n.match(p)?(e.account.email=t,e.account.username=n,e.account.save(function(e,n){if(e)c.error("auth","Failed to update password",{error:e}),o.status(500).json({message:"Failed to update password."});else{var t=r.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:n.username,email:n.email}},process.env.MY_SECRET);o.status(200).json({token:t,account:{username:n.username,email:n.email,_id:n._id}})}})):o.status(400).json({message:"Username must be alphanumeric and between 5 and 50 characters."})}),d.get("/logout",f(),function(e,o){var n=e.headers.authorization&&e.headers.authorization.split(" ");n=n&&2===n.length&&"bearer"===n[0].toLowerCase()?n[1]:null,a.set(i.blacklistPrefix+n,!0,function(t,r){t&&(c.error("auth","Failed to logout",{error:t}),e.status(500).json({message:"Failed to log out"})),r&&setTimeout(function(){a.del(i.blacklistPrefix+n)},36e5),e.query.redirect_uri?o.redirect(302,e.query.redirect_uri):o.status(200).json({ok:!0})})}),e.exports=d},function(e,o){e.exports=require("jsonwebtoken")},function(e,o,n){"use strict";var t=n(21),r=new t({stdTTL:3600,checkperiod:60});e.exports=r},function(e,o){e.exports=require("node-cache")},function(e,o,n){"use strict";var t=n(23),r=function(e){return t.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},s=function(e,o){var n=t.createHmac("sha512",o);return n.update(e),n.digest("hex")},a=function(e){var o=r(32);return{salt:o,hash:s(e,o)}},i=function(e,o,n){return s(e,o)===n};e.exports={generateSaltAndHash:a,verifyPassword:i}},function(e,o){e.exports=require("crypto")},function(e,o,n){"use strict";var t=n(19),r=n(20),s=n(13),a=n(9),i=function(){return function(e,o,n){var i=e.headers.authorization&&e.headers.authorization.split(" ");i=i&&2===i.length&&"bearer"===i[0].toLowerCase()?i[1]:null,i?r.get(s.blacklistPrefix+i,function(r,s){s?o.status(401).json({message:"Old token provided"}):r?(a.error("security","Error retrieving blacklisted tokens",{error:r}),o.status(500).json({message:"Error checking old token"})):t.verify(i,process.env.MY_SECRET,function(t,r){t?o.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=r,n())})}):o.status(401).json({message:"Unauthorized: No token provided"})}};e.exports=i},function(e,o,n){"use strict";var t=n(5),r=n(26),s=n(9),a=t.Router(),i=void 0,u=r.createTransport({service:"Gmail",auth:{user:process.env.SERVICE_EMAIL,pass:process.env.EMAIL_PASSWORD}}),c=function(e,o,n,t,r){var s={from:e+" <"+o+">",to:process.env.SERVICE_EMAIL,replyTo:o,subject:n,html:t};u.sendMail(s,r)},l=function(e){e?(s.error("email","Error sending email",{error:e}),i.status(500).json({message:"Unable to send email at this time."})):(s.info("email","Email sent successfully"),i.status(201).json({message:"Email sent successfully"}))};a.post("/",function(e,o){if(i=null,e.body.email&&e.body.name&&e.body.subject&&e.body.message){var n="<p>"+e.body.message+"</p>";i=o,c(e.body.name,e.body.email,e.body.subject,n,l)}else o.status(400).json({message:"Invalid email format"})}),e.exports=a},function(e,o){e.exports=require("nodemailer")},function(e,o,n){(function(e){"use strict";var o=n(5),t=n(7),r=n(9),s=n(11),a=new o.Router;a.get("/",function(e,o){s.findAllProfiles({accountId:e.account._id}).then(function(e){o.status(200).json({total:e.length,data:e})}).catch(function(e){r.error("profile","Error getting all profiles",{error:e}),o.status(500).json({message:"Could not find profiles"})})}),a.get("/:profileId",function(e,o){t.Types.ObjectId.isValid(e.params.profileId)?s.findProfile({_id:e.params.profileId,accountId:e.account._id}).then(function(e){e?o.status(200).json(e):o.status(404).send()}).catch(function(e){r.error("profile","Error getting specified profile",{error:e}),o.status(500).json({message:"Could not find profile"})}):o.status(404).send()}),a.put("/:profileId",function(e,o){var n=e.body;s.findProfile({_id:e.params.profileId}).then(function(e){Object.keys(n).forEach(function(o){e[o]!==n[o]&&(e[o]=n[o])}),e.save(function(n,t){n?(r.error("profile","Error updating profile",{error:n}),o.status(500).json({message:"Error updating profile"})):(r.verbose("profile","Profile updated successfully",{email:e.email}),o.status(200).json(t))})}).catch(function(e){r.error("profile","Could not find profile",{error:e}),o.status(500).json({message:"Could not find profile"})})}),e=e.exports=a}).call(o,n(28)(e))},function(e,o){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,o,n){"use strict";var t=n(5),r=n(9),s=n(11),a=new t.Router;a.get("/",function(e,o){var n=void 0;s.findProfile({accountId:e.account._id}).then(function(e){return s.findAllGoals({profileId:e})}).then(function(e){n=e;var o=e.map(function(e){return s.findAllSubgoals({goalId:e._id})});return Promise.all(o)}).then(function(e){n.forEach(function(o,n){o.subgoals=e[n]}),o.status(200).json({total:n.length,data:n})}).catch(function(e){r.error("goals","Error getting goals",e),o.status(500).send("Internal server error retrieving goals")})}),a.post("/",function(e,o){var n=e.body.subgoals&&JSON.parse(JSON.stringify(e.body.subgoals)),t=void 0;return delete e.body.subgoals,s.addGoal(e.body).then(function(e){t=e;var o=n.map(function(o){return o.goalId=e._id,s.addSubgoal(o)});return Promise.all(o)}).then(function(e){t.subgoals=e,o.status(201).json(t)}).catch(function(e){r.error("goals","Error adding a goal",e),o.status(500).send("Internal server error adding goal")})}),e.exports=a},function(e,o,n){"use strict";var t=n(7),r=t.Schema,s=new r({goalId:r.Types.ObjectId,description:String,complete:Boolean});e.exports=t.model("Subgoal",s)}]);