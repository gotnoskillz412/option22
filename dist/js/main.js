!function(e){function t(r){if(s[r])return s[r].exports;var o=s[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var s={};t.m=e,t.c=s,t.p="",t(0)}([function(e,t,s){s(1),s(11),s(8),s(23),s(12),s(14),s(17),s(24),s(16),s(26),s(15),s(21),s(19),e.exports=s(9)},function(e,t,s){"use strict";var r=s(2),o=s(3),n=s(4),a=s(5),i=s(6),u=s(7),c=s(8),l=s(9),f=s(15),d=s(23),m=parseInt(process.env.API_PORT,10)||3e3,p={origin:process.env.BASE_WEB||"*",credentials:!0,optionsSuccessStatus:200},g=a();g.use(r.json()),g.use(r.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),g.use(o()),g.use(i({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),g.use(n(p)),g.use("/",f.index),g.use("/auth",f.auth),g.use("/email",f.email),g.use("/accounts/:accountId/profiles",d(),c(),f.profile),u.Promise=global.Promise,u.connect(process.env.MONGO_URI),g.use(function(e,t,s){var r=new Error("Not Found");r.status=404,s(r)}),"development"===g.get("env")&&g.use(function(e,t,s){s.status(e.status||500)}),g.use(function(e,t,s){s.status(e.status||500)}),g.listen(m,function(){l.info("app.js","App listening on port "+m+"...")}),e.exports=g},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("mongoose")},function(e,t,s){"use strict";var r=s(7),o=s(9),n=s(11),a=function(){return function(e,t,s){var a=e.params.accountId;r.Types.ObjectId.isValid(a)?n.findAccount({_id:a}).then(function(r){r?(e.account=r,s()):t.status(404).send()}).catch(function(e){o.error("accountExtractor","Error checking account",{error:e}),t.status(500).json({message:"Error finding account"})}):t.status(404).send()}};e.exports=a},function(e,t,s){"use strict";var r=s(10),o=new r.Logger({transports:[new r.transports.Console({colorize:!0,level:"silly",prettyPrint:!0,timestamp:!0}),new r.transports.File({colorize:!0,filename:"logs/log.txt",level:"info",timestamp:!0})]});o.emitErrs=!1,"test"===process.env.NODE_ENV&&(o.remove(r.transports.Console),o.remove(r.transports.File)),e.exports=o},function(e,t){e.exports=require("winston")},function(e,t,s){"use strict";var r=s(12),o=s(13),n=s(9),a=s(14),i=function(e){return new Promise(function(t,s){r.findOne(e,function(e,r){e?s({step:o.mongo.steps.accountFind,message:"Error finding account",error:e}):t(r)})})},u=function(e){return new Promise(function(t,s){new r(e).save(function(r,a){r?s({step:o.mongo.steps.accountCreate,message:"Error creating account",error:r}):(n.info("mongooseHelpers","Successfully created acount for: "+e.email),t(a))})})},c=function(e){return new Promise(function(t,s){r.remove(e,function(r,a){r?s({step:o.mongo.steps.accountDelete,message:"Error deleting account",error:r}):(n.info("mongooseHelpers","Successfully removed acount for: "+e.email),t(a))})})},l=function(e){return new Promise(function(t,s){new a(e).save(function(r,a){r?s({step:o.mongo.steps.profileCreate,message:"Error creating profile",error:r}):(n.info("mongooseHelpers","Successfully created profile for: "+e.email),t(a))})})},f=function(e){return new Promise(function(t,s){a.find(e,function(e,r){e?s({step:o.mongo.steps.profileFind,message:"Error finding profiles",error:e}):t(r)})})},d=function(e){return new Promise(function(t,s){a.findOne(e,function(e,r){e?s({step:o.mongo.steps.profileFind,message:"Error finding profile",error:e}):t(r)})})},m=function(e){return new Promise(function(t,s){a.remove(e,function(r,a){r?s({step:o.mongo.steps.profileDelete,message:"Error deleting profile",error:r}):(n.info("mongooseHelpers","Successfully removed profile for: "+e.email),t(a))})})};e.exports={findAccount:i,createAccount:u,removeAccount:c,createProfile:l,findProfile:d,findAllProfiles:f,removeProfile:m}},function(e,t,s){"use strict";var r=s(7),o=r.Schema,n=new o({email:String,hash:String,salt:String,username:String});e.exports=r.model("Account",n)},function(e,t){e.exports={mongo:{steps:{accountCreate:"account-create",accountDelete:"account-delete",accountFind:"account-find",profileCreate:"profile-create",profileDelete:"profile-delete",profileUpdate:"profile-update",profileFind:"profile-find"}},blacklistPrefix:"option22-token-blacklist-"}},function(e,t,s){"use strict";var r=s(7),o=r.Schema,n=new o({accountId:o.Types.ObjectId,description:String,firstName:String,lastName:String,likes:[String],picture:String});e.exports=r.model("Profile",n)},function(e,t,s){"use strict";e.exports={index:s(16),auth:s(17),email:s(24),profile:s(26)}},function(e,t,s){"use strict";var r=s(5),o=r.Router();o.get("/",function(e,t){t.status(200).json({ok:!0})}),e.exports=o},function(e,t,s){"use strict";var r=s(5),o=s(18),n=s(8),a=s(19),i=s(13),u=s(21),c=s(9),l=s(11),f=s(23),d=r.Router(),m=new RegExp("(?=^.{8,}$)((?=.*d)|(?=.*W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$"),p=new RegExp("^([a-zA-Z0-9_]{5,50})$");d.post("/register",function(e,t){var s=e.body.firstName||null,r=e.body.lastName||null,n=e.body.username.toLowerCase(),a=e.body.email.toLowerCase(),f=null;l.findAccount({email:a}).then(function(e){return e?Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that email already exists.",error:null}):l.findAccount({username:n})}).then(function(t){if(!t){var s=e.body.password;if(!s.match(m))return Promise.reject({step:i.mongo.steps.accountCreate,message:"Password did not meet requirements."});if(!n.match(p))return Promise.reject({step:i.mongo.steps.accountCreate,message:"Username must be alphanumeric and between 5 and 50 characters."});var r=u.generateSaltAndHash(s);return l.createAccount({username:n,email:a,salt:r.salt,hash:r.hash})}return Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that username already exists.",error:null})}).then(function(e){return f=e,l.createProfile({accountId:e._id,firstName:s,lastName:r})}).then(function(e){var s=o.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:n,email:a}},process.env.MY_SECRET);t.status(201).json({token:s,profile:e,account:{email:f.email,username:f.username,_id:f._id}})}).catch(function(e){e.step===i.mongo.steps.profileCreate?l.removeAccount({email:a}).then(function(){t.status(500).json({message:e.message})}):e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),d.post("/login",function(e,t){var s=e.body.username&&e.body.username.toLowerCase(),r=e.body.password,n=null;l.findAccount({username:s}).then(function(e){e&&u.verifyPassword(r,e.salt,e.hash)?(n=e,l.findProfile({accountId:n._id}).then(function(e){var r=o.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:s,email:n.email}},process.env.MY_SECRET);c.verbose("auth","Login successful",{email:n.email}),t.status(201).json({token:r,profile:e,account:{email:n.email,username:n.username,_id:n._id}})})):t.status(401).json({message:"Incorrect username or password"})}).catch(function(e){e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),d.get("/account",f(),function(e,t){l.findAccount({username:e.decoded.data.username}).then(function(e){e?l.findProfile({accountId:e._id}).then(function(s){s?t.status(200).json({account:{email:e.email,username:e.username,_id:e._id},profile:s}):t.status(500).json({message:"Failed to find profile"})}):t.status(500).json({message:"Failed to find account"})}).catch(function(e){e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),d.put("/account/:accountId/password",f(),n(),function(e,t){var s=e.body.newPassword,r=e.body.currentPassword;if(e.account&&u.verifyPassword(r,e.account.salt,e.account.hash)){var n=u.generateSaltAndHash(s);e.account.salt=n.salt,e.account.hash=n.hash;var a=o.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:e.account.username,email:e.account.email}},process.env.MY_SECRET);e.account.save(function(e,s){e?(c.error("auth","Failed to update password",{error:e}),t.status(500).json({message:"Failed to update password."})):t.status(200).json({token:a,account:{username:s.username,email:s.email,_id:s._id}})})}else t.status(400).json({message:"Incorrect password"})}),d.put("/account/:accountId/update",f(),n(),function(e,t){var s=e.body.username,r=e.body.email;s.match(p)?(e.account.email=r,e.account.username=s,e.account.save(function(e,s){if(e)c.error("auth","Failed to update password",{error:e}),t.status(500).json({message:"Failed to update password."});else{var r=o.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:s.username,email:s.email}},process.env.MY_SECRET);t.status(200).json({token:r,account:{username:s.username,email:s.email,_id:s._id}})}})):t.status(400).json({message:"Username must be alphanumeric and between 5 and 50 characters."})}),d.get("/logout",f(),function(e,t){var s=e.headers.authorization&&e.headers.authorization.split(" ");s=s&&2===s.length&&"bearer"===s[0].toLowerCase()?s[1]:null,a.set(i.blacklistPrefix+s,!0,function(r,o){r&&(c.error("auth","Failed to logout",{error:r}),e.status(500).json({message:"Failed to log out"})),o&&setTimeout(function(){a.del(i.blacklistPrefix+s)},36e5),e.query.redirect_uri?t.redirect(302,e.query.redirect_uri):t.status(200).json({ok:!0})})}),e.exports=d},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,s){"use strict";var r=s(20),o=new r({stdTTL:3600,checkperiod:60});e.exports=o},function(e,t){e.exports=require("node-cache")},function(e,t,s){"use strict";var r=s(22),o=function(e){return r.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},n=function(e,t){var s=r.createHmac("sha512",t);return s.update(e),s.digest("hex")},a=function(e){var t=o(32);return{salt:t,hash:n(e,t)}},i=function(e,t,s){return n(e,t)===s};e.exports={generateSaltAndHash:a,verifyPassword:i}},function(e,t){e.exports=require("crypto")},function(e,t,s){"use strict";var r=s(18),o=s(19),n=s(13),a=s(9),i=function(){return function(e,t,s){var i=e.headers.authorization&&e.headers.authorization.split(" ");i=i&&2===i.length&&"bearer"===i[0].toLowerCase()?i[1]:null,i?o.get(n.blacklistPrefix+i,function(o,n){n?t.status(401).json({message:"Old token provided"}):o?(a.error("security","Error retrieving blacklisted tokens",{error:o}),t.status(500).json({message:"Error checking old token"})):r.verify(i,process.env.MY_SECRET,function(r,o){r?t.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=o,s())})}):t.status(401).json({message:"Unauthorized: No token provided"})}};e.exports=i},function(e,t,s){"use strict";var r=s(5),o=s(25),n=s(9),a=r.Router(),i=void 0,u=o.createTransport({service:"Gmail",auth:{user:process.env.SERVICE_EMAIL,pass:process.env.EMAIL_PASSWORD}}),c=function(e,t,s,r,o){var n={from:e+" <"+t+">",to:process.env.SERVICE_EMAIL,replyTo:t,subject:s,html:r};u.sendMail(n,o)},l=function(e){e?(n.error("email","Error sending email",{error:e}),i.status(500).json({message:"Unable to send email at this time."})):(n.info("email","Email sent successfully"),i.status(201).json({message:"Email sent successfully"}))};a.post("/",function(e,t){if(i=null,e.body.email&&e.body.name&&e.body.subject&&e.body.message){var s="<p>"+e.body.message+"</p>";i=t,c(e.body.name,e.body.email,e.body.subject,s,l)}else t.status(400).json({message:"Invalid email format"})}),e.exports=a},function(e,t){e.exports=require("nodemailer")},function(e,t,s){(function(e){"use strict";var t=s(5),r=s(7),o=s(9),n=s(11),a=new t.Router;a.get("/",function(e,t){n.findAllProfiles({accountId:e.account._id}).then(function(e){t.status(200).json({total:e.length,data:e})}).catch(function(e){o.error("profile","Error getting all profiles",{error:e}),t.status(500).json({message:"Could not find profiles"})})}),a.get("/:profileId",function(e,t){r.Types.ObjectId.isValid(e.params.profileId)?n.findProfile({_id:e.params.profileId,accountId:e.account._id}).then(function(e){e?t.status(200).json(e):t.status(404).send()}).catch(function(e){o.error("profile","Error getting specified profile",{error:e}),t.status(500).json({message:"Could not find profile"})}):t.status(404).send()}),a.put("/:profileId",function(e,t){var s=e.body;n.findProfile({_id:e.params.profileId}).then(function(e){Object.keys(s).forEach(function(t){e[t]!==s[t]&&(e[t]=s[t])}),e.save(function(s,r){s?(o.error("profile","Error updating profile",{error:s}),t.status(500).json({message:"Error updating profile"})):(o.verbose("profile","Profile updated successfully",{email:e.email}),t.status(200).json(r))})}).catch(function(e){o.error("profile","Could not find profile",{error:e}),t.status(500).json({message:"Could not find profile"})})}),e=e.exports=a}).call(t,s(27)(e))},function(e,t){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}}]);