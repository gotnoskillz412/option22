!function(e){function t(n){if(s[n])return s[n].exports;var r=s[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var s={};t.m=e,t.c=s,t.p="",t(0)}([function(e,t,s){s(1),s(19),s(9),s(20),s(21),s(16),s(22),s(15),s(24),s(14),s(11),s(17),e.exports=s(26)},function(e,t,s){"use strict";var n=s(2),r=s(3),o=s(4),a=s(5),i=s(6),u=s(7),c=s(8),f=s(9),l=s(14),p=parseInt(process.env.API_PORT,10)||3e3,d={origin:process.env.BASE_WEB||"*",optionsSuccessStatus:200},m=n();m.use(r.json()),m.use(r.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),m.use(o()),m.use(i({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),m.use(c(d)),m.use("/",l.index),m.use("/auth",l.auth),m.use("/email",l.email),m.use("/profile",f(),l.profile),u.Promise=global.Promise,u.connect(process.env.MONGO_URI),m.use(function(e,t,s){var n=new Error("Not Found");n.status=404,s(n)}),"development"===m.get("env")&&m.use(function(e,t,s){s.status(e.status||500),s.render("error",{message:e.message,error:e})}),m.use(function(e,t,s){s.status(e.status||500),s.render("error",{message:e.message,error:{}})}),m.listen(p,function(){a.info("App listening on port "+p+"...")})},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("cors")},function(e,t,s){"use strict";var n=s(10),r=s(11),o=s(13),a=function(){return function(e,t,s){var a=e.headers.authorization&&e.headers.authorization.split(" ");a=a&&2===a.length&&"bearer"===a[0].toLowerCase()?a[1]:null,a?r.get(o.blacklistPrefix+a,function(r,o){console.log(r),o?t.status(401).json({message:"Old token provided"}):n.verify(a,process.env.MY_SECRET,function(n,r){n?t.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=r,s())})}):t.status(401).json({message:"Unauthorized: No token provided"})}};e.exports=a},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,s){"use strict";var n=s(12),r=new n({stdTTL:3600,checkperiod:60});e.exports=r},function(e,t){e.exports=require("node-cache")},function(e,t){e.exports={mongo:{steps:{accountCreate:"account-create",accountDelete:"account-delete",accountFind:"account-find",profileCreate:"profile-create",profileDelete:"profile-delete",profileUpdate:"profile-update"}},blacklistPrefix:"option22-token-blacklist-"}},function(e,t,s){"use strict";e.exports={index:s(15),auth:s(16),email:s(22),profile:s(24)}},function(e,t,s){"use strict";var n=s(2),r=n.Router();r.get("/",function(e,t){t.status(200).send("ok")}),e.exports=r},function(e,t,s){"use strict";var n=s(2),r=s(10),o=s(5),a=s(11),i=s(13),u=s(17),c=s(19),f=s(9),l=n.Router();l.post("/register",function(e,t){var s=e.body.username.toLowerCase(),n=e.body.email.toLowerCase();c.findAccount({email:n}).then(function(e){return e?Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that email already exists.",error:null}):c.findAccount({username:s})}).then(function(t){if(!t){var r=e.body.password,o=u.generateSaltAndHash(r);return c.createAccount({username:s,email:n,salt:o.salt,hash:o.hash})}return Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that username already exists.",error:null})}).then(function(){return c.createProfile({email:n})}).then(function(){var e=r.sign({exp:Math.floor(Date.now()/1e3)+3600,data:s},process.env.MY_SECRET);t.status(201).json({token:e})}).catch(function(e){e.step===i.mongo.steps.profileCreate?c.removeAccount({email:n}).then(function(){t.status(500).json({message:e.message})}):e.error?(o.error(e.step,e.message,e.error),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),l.post("/login",function(e,t){var s=e.body.username&&e.body.username.toLowerCase(),n=e.body.password;c.findAccount({username:s}).then(function(e){if(e&&u.verifyPassword(n,e.salt,e.hash)){var s=r.sign({exp:Math.floor(Date.now()/1e3)+3600,data:e.username},process.env.MY_SECRET);o.info("login success"),t.status(201).json({token:s})}else t.status(401).json({message:"Incorrect username or password"})}).catch(function(e){e.error?(o.error(e.step,e.message,e.error),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),l.get("/logout",f(),function(e,t){var s=e.headers.authorization&&e.headers.authorization.split(" ");s=s&&2===s.length&&"bearer"===s[0].toLowerCase()?s[1]:null,a.set(i.blacklistPrefix+s,!0,function(n,r){console.log(n),r&&setTimeout(function(){redis.del(i.blacklistPrefix+s)},36e5),e.query.redirect_uri?t.redirect(e.query.redirect_uri):t.status(200).send("ok")})}),l.get("/test",f(),function(e,t){t.status(200).send("ok")}),e.exports=l},function(e,t,s){"use strict";var n=s(18),r=function(e){return n.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},o=function(e,t){var s=n.createHmac("sha512",t);return s.update(e),s.digest("hex")},a=function(e){var t=r(32);return{salt:t,hash:o(e,t)}},i=function(e,t,s){return o(e,t)===s};e.exports={generateSaltAndHash:a,verifyPassword:i}},function(e,t){e.exports=require("crypto")},function(e,t,s){"use strict";var n=s(20),r=s(13),o=s(5),a=s(21),i=function(e){return new Promise(function(t,s){n.findOne(e,function(e,n){e?s({step:r.mongo.steps.accountFind,message:"Error finding account",error:e}):t(n)})})},u=function(e){return new Promise(function(t,s){new n(e).save(function(n,a){n?s({step:r.mongo.steps.accountCreate,message:"Error creating account",error:n}):(o.info("Successfully created acount for: "+e.email),t(a))})})},c=function(e){return new Promise(function(t,s){n.remove(e,function(n,a){n?s({step:r.mongo.steps.accountDelete,message:"Error deleting account",error:n}):(o.info("Successfully removed acount for: "+e.email),t(a))})})},f=function(e){return new Promise(function(t,s){new a(e).save(function(n,a){n?s({step:r.mongo.steps.profileCreate,message:"Error creating profile",error:n}):(o.info("Successfully created profile for: "+e.email),t(a))})})};e.exports={findAccount:i,createAccount:u,removeAccount:c,createProfile:f}},function(e,t,s){"use strict";var n=s(7),r=n.Schema,o=new r({username:String,email:String,salt:String,hash:String});e.exports=n.model("Account",o)},function(e,t,s){"use strict";var n=s(7),r=n.Schema,o=new r({picture:{data:Buffer,contentType:String},description:String,likes:[String],email:String});e.exports=n.model("Profile",o)},function(e,t,s){"use strict";var n=s(2),r=s(23),o=s(5),a=n.Router(),i=r.createTransport({service:"Gmail",auth:{user:process.env.SERVICE_EMAIL,pass:process.env.EMAIL_PASSWORD}}),u=function(e,t,s,n,r){var o={from:e+" <"+t+">",to:process.env.SERVICE_EMAIL,replyTo:t,subject:s,html:n};i.sendMail(o,r)};a.post("/",function(e,t){if(e.body.email&&e.body.name&&e.body.subject&&e.body.message){var s="<p>"+e.body.message+"</p>";u(e.body.name,e.body.email,e.body.subject,s,function(e,s){e?(o.error(e),t.status(500).json({message:"Unable to send email at this time."})):(o.info(s),t.status(201).json({message:"Email sent successfully"}))})}else console.log("bad email",e.body),t.status(400).json({message:"Invalid email format"})}),e.exports=a},function(e,t){e.exports=require("nodemailer")},function(e,t,s){(function(e){"use strict";var t=s(2),n=new t.Router;n.get("/",function(){}),n.put("/:accountId",function(){}),e=e.exports=n}).call(t,s(25)(e))},function(e,t){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){"use strict"}]);