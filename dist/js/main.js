!function(e){function t(o){if(r[o])return r[o].exports;var s=r[o]={exports:{},id:o,loaded:!1};return e[o].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){r(1),r(19),r(22),r(20),r(21),r(12),r(23),r(11),r(25),r(10),r(14),r(17),e.exports=r(8)},function(e,t,r){"use strict";var o=r(2),s=r(3),n=r(4),i=r(5),a=r(6),u=r(7),c=r(8),l=r(10),f=r(22),p=parseInt(process.env.API_PORT,10)||3e3,m={origin:process.env.BASE_WEB||"*",credentials:!0,optionsSuccessStatus:200},d=i();d.use(o.json()),d.use(o.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),d.use(s()),d.use(a({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),d.use(n(m)),d.use("/",l.index),d.use("/auth",l.auth),d.use("/email",l.email),d.use("/profile",f(),l.profile),u.Promise=global.Promise,u.connect(process.env.MONGO_URI),d.use(function(e,t,r){var o=new Error("Not Found");o.status=404,r(o)}),"development"===d.get("env")&&d.use(function(e,t,r){r.status(e.status||500)}),d.use(function(e,t,r){r.status(e.status||500)}),d.listen(p,function(){c.info("app.js","App listening on port "+p+"...")})},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("mongoose")},function(e,t,r){"use strict";var o=r(9),s=new o.Logger({transports:[new o.transports.Console({colorize:!0,level:"silly",prettyPrint:!0,timestamp:!0}),new o.transports.File({colorize:!0,filename:"logs/log.txt",level:"info",timestamp:!0})]});s.emitErrs=!1,e.exports=s},function(e,t){e.exports=require("winston")},function(e,t,r){"use strict";e.exports={index:r(11),auth:r(12),email:r(23),profile:r(25)}},function(e,t,r){"use strict";var o=r(5),s=o.Router();s.get("/",function(e,t){t.status(200).send("ok")}),e.exports=s},function(e,t,r){"use strict";var o=r(5),s=r(13),n=r(14),i=r(16),a=r(17),u=r(8),c=r(19),l=r(22),f=o.Router();f.post("/register",function(e,t){var r=e.body.username.toLowerCase(),o=e.body.email.toLowerCase();c.findAccount({email:o}).then(function(e){return e?Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that email already exists.",error:null}):c.findAccount({username:r})}).then(function(t){if(!t){var s=e.body.password,n=a.generateSaltAndHash(s);return c.createAccount({username:r,email:o,salt:n.salt,hash:n.hash})}return Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that username already exists.",error:null})}).then(function(){return c.createProfile({username:r,email:o})}).then(function(e){var n=s.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:r,email:o}},process.env.MY_SECRET);t.status(201).json({token:n,profile:e})}).catch(function(e){e.step===i.mongo.steps.profileCreate?c.removeAccount({email:o}).then(function(){t.status(500).json({message:e.message})}):e.error?(u.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),f.post("/login",function(e,t){var r=e.body.username&&e.body.username.toLowerCase(),o=e.body.password;c.findAccount({username:r}).then(function(e){e&&a.verifyPassword(o,e.salt,e.hash)?c.findProfile({username:r}).then(function(o){var n=s.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:r,email:e.email}},process.env.MY_SECRET);u.verbose("auth","Login successful",{email:e.email}),t.status(201).json({token:n,profile:o})}):t.status(401).json({message:"Incorrect username or password"})}).catch(function(e){e.error?(u.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),f.get("/logout",l(),function(e,t){var r=e.headers.authorization&&e.headers.authorization.split(" ");r=r&&2===r.length&&"bearer"===r[0].toLowerCase()?r[1]:null,n.set(i.blacklistPrefix+r,!0,function(o,s){o&&(u.error("auth","Failed to logout",{error:o}),e.status(500).json({message:"Failed to log out"})),s&&setTimeout(function(){n.del(i.blacklistPrefix+r)},36e5),e.query.redirect_uri?t.redirect(e.query.redirect_uri,{}):t.status(200).send("ok")})}),e.exports=f},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";var o=r(15),s=new o({stdTTL:3600,checkperiod:60});e.exports=s},function(e,t){e.exports=require("node-cache")},function(e,t){e.exports={mongo:{steps:{accountCreate:"account-create",accountDelete:"account-delete",accountFind:"account-find",profileCreate:"profile-create",profileDelete:"profile-delete",profileUpdate:"profile-update",profileFind:"profile-find"}},blacklistPrefix:"option22-token-blacklist-"}},function(e,t,r){"use strict";var o=r(18),s=function(e){return o.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},n=function(e,t){var r=o.createHmac("sha512",t);return r.update(e),r.digest("hex")},i=function(e){var t=s(32);return{salt:t,hash:n(e,t)}},a=function(e,t,r){return n(e,t)===r};e.exports={generateSaltAndHash:i,verifyPassword:a}},function(e,t){e.exports=require("crypto")},function(e,t,r){"use strict";var o=r(20),s=r(16),n=r(8),i=r(21),a=function(e){return new Promise(function(t,r){o.findOne(e,function(e,o){e?r({step:s.mongo.steps.accountFind,message:"Error finding account",error:e}):t(o)})})},u=function(e){return new Promise(function(t,r){new o(e).save(function(o,i){o?r({step:s.mongo.steps.accountCreate,message:"Error creating account",error:o}):(n.info("mongooseHelpers","Successfully created acount for: "+e.email),t(i))})})},c=function(e){return new Promise(function(t,r){o.remove(e,function(o,i){o?r({step:s.mongo.steps.accountDelete,message:"Error deleting account",error:o}):(n.info("mongooseHelpers","Successfully removed acount for: "+e.email),t(i))})})},l=function(e){return new Promise(function(t,r){new i(e).save(function(o,i){o?r({step:s.mongo.steps.profileCreate,message:"Error creating profile",error:o}):(n.info("mongooseHelpers","Successfully created profile for: "+e.email),t(i))})})},f=function(e){return new Promise(function(t,r){i.findOne(e,function(e,o){e?r({step:s.mongo.steps.profileFind,message:"Error finding profile",error:e}):t(o)})})};e.exports={findAccount:a,createAccount:u,removeAccount:c,createProfile:l,findProfile:f}},function(e,t,r){"use strict";var o=r(7),s=o.Schema,n=new s({username:String,email:String,salt:String,hash:String});e.exports=o.model("Account",n)},function(e,t,r){"use strict";var o=r(7),s=o.Schema,n=new s({picture:String,description:String,likes:[String],email:String,username:String});e.exports=o.model("Profile",n)},function(e,t,r){"use strict";var o=r(13),s=r(14),n=r(16),i=r(8),a=function(){return function(e,t,r){var a=e.headers.authorization&&e.headers.authorization.split(" ");a=a&&2===a.length&&"bearer"===a[0].toLowerCase()?a[1]:null,a?s.get(n.blacklistPrefix+a,function(s,n){n?t.status(401).json({message:"Old token provided"}):s?(i.error("security","Error retrieving blacklisted tokens",{error:s}),t.status(500).json({message:"Error checking old token"})):o.verify(a,process.env.MY_SECRET,function(o,s){o?t.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=s,r())})}):t.status(401).json({message:"Unauthorized: No token provided"})}};e.exports=a},function(e,t,r){"use strict";var o=r(5),s=r(24),n=r(8),i=o.Router(),a=s.createTransport({service:"Gmail",auth:{user:process.env.SERVICE_EMAIL,pass:process.env.EMAIL_PASSWORD}}),u=function(e,t,r,o,s){var n={from:e+" <"+t+">",to:process.env.SERVICE_EMAIL,replyTo:t,subject:r,html:o};a.sendMail(n,s)},c=function(e){e?(n.error("email","Error sending email",{error:e}),res.status(500).json({message:"Unable to send email at this time."})):(n.info("email","Email sent successfully"),res.status(201).json({message:"Email sent successfully"}))};i.post("/",function(e,t){if(e.body.email&&e.body.name&&e.body.subject&&e.body.message){var r="<p>"+e.body.message+"</p>";u(e.body.name,e.body.email,e.body.subject,r,c)}else t.status(400).json({message:"Invalid email format"})}),e.exports=i},function(e,t){e.exports=require("nodemailer")},function(e,t,r){(function(e){"use strict";var t=r(5),o=r(8),s=r(19),n=new t.Router;n.get("/",function(e,t){s.findProfile({username:e.decoded.data.username,email:e.decoded.data.email}).then(function(e){var r={profile:e};t.status(200).json(r)}).catch(function(){t.status(500).json({message:"Could not find profile"})})}),n.put("/",function(){}),n.post("/picture",function(e,t){s.findProfile({username:e.decoded.data.username,email:e.decoded.data.email}).then(function(r){r.picture=e.body.image,r.save(function(e){e?(o.error("profile","Error saving the profile picture",{error:e}),t.status(500).json({message:"Error uploading file"})):(o.verbose("profile","Picture saved successfully to account",{email:r.email}),t.status(200).send("success"))})}).catch(function(e){o.error("profile","Could not find profile",{error:e}),t.status(500).json({message:"Could not find profile"})})}),e=e.exports=n}).call(t,r(26)(e))},function(e,t){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}}]);