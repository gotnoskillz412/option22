!function(e){function s(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}var t={};return s.m=e,s.c=t,s.p="",s(0)}([function(e,s,t){t(1),t(13),t(11),t(10),t(9),t(14),e.exports=t(15)},function(e,s,t){"use strict";var r=t(2),n=t(3),o=t(4),a=t(5),i=t(6),u=t(7),c=t(8),d=t(9),f={origin:"http://localhost:4200",optionsSuccessStatus:200},l=3e3,p=r(),g=process.env.MONGO_URI||"mongodb://localhost/option22";process.env.MY_SECRET="LordJeanLucSkywalker",p.use(n.json()),p.use(n.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),p.use(o()),p.use(i({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),p.use(c(f)),p.use("/",d.index),p.use("/auth",d.auth),u.Promise=global.Promise,u.connect(g),p.use(function(e,s,t){var r=new Error("Not Found");r.status=404,t(r)}),"development"===p.get("env")&&p.use(function(e,s,t){t.status(e.status||500),t.render("error",{message:e.message,error:e})}),p.use(function(e,s,t){t.status(e.status||500),t.render("error",{message:e.message,error:{}})}),p.listen(l,function(){a.info("App listening on port "+l+"...")})},function(e,s){e.exports=require("express")},function(e,s){e.exports=require("body-parser")},function(e,s){e.exports=require("cookie-parser")},function(e,s){e.exports=require("winston")},function(e,s){e.exports=require("express-session")},function(e,s){e.exports=require("mongoose")},function(e,s){e.exports=require("cors")},function(e,s,t){"use strict";s=e.exports={index:t(10),auth:t(11)}},function(e,s,t){"use strict";var r=t(2),n=r.Router();n.get("/",function(e,s){s.status(200).send("ok")}),s=e.exports=n},function(e,s,t){"use strict";var r=t(2),n=r.Router(),o=t(5),a=t(12),i=t(13),u=t(14),c=t(15);n.post("/register",function(e,s){var t=e.body.username.toLowerCase(),r=e.body.email.toLowerCase();u.findOne({email:r},function(n,i){n?s.status(500).json({message:"Error registering"}):i?s.status(400).json({message:"An account with this email already exists"}):u.findOne({username:t},function(n,i){if(n)s.status(500).json({message:"Error registering"});else if(i)s.status(400).json({message:"This username is already taken"});else{var d=e.body.password,f=c.generateSaltAndHash(d),l=new u({username:t,email:r,salt:f.salt,hash:f.hash});l.save(function(e){if(e)o.error(e),s.status(500).json({message:"Problem creating new account"});else{o.info("Succressfull created acount for: ",r);var n=a.sign({exp:Math.floor(Date.now()/1e3)+3600,data:t},process.env.MY_SECRET);s.status(201).json({token:n})}})}})})}),n.post("/login",function(e,s){var t=e.body.username&&e.body.username.toLowerCase(),r=e.body.password;u.findOne({username:t},function(e,t){if(e)s.status(400).json({message:"Incorrect username or password"});else if(t&&c.verifyPassword(r,t.salt,t.hash)){var n=a.sign({exp:Math.floor(Date.now()/1e3)+3600,data:t.username},process.env.MY_SECRET);o.info("login success"),s.status(201).json({token:n})}else s.status(401).json({message:"Incorrect username or password"})})}),n.get("/logout",function(e,s){s.redirect("/")}),n.get("/test",i(),function(e,s){s.status(200).send("ok")}),s=e.exports=n},function(e,s){e.exports=require("jsonwebtoken")},function(e,s,t){"use strict";var r=t(12),n=function(){return function(e,s,t){var n=e.headers.authorization&&e.headers.authorization.split(" ");n=n&&2===n.length&&"bearer"===n[0].toLowerCase()?n[1]:null,n?r.verify(n,process.env.MY_SECRET,function(r,n){r?s.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=n,t())}):s.status(401).json({message:"Unauthorized: No token provided"})}};s=e.exports=n},function(e,s,t){"use strict";var r=t(7),n=r.Schema,o=new n({username:String,email:String,salt:String,hash:String});s=e.exports=r.model("Account",o)},function(e,s,t){"use strict";var r=t(16),n=32,o=function(e){return r.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},a=function(e,s){var t=r.createHmac("sha512",s);return t.update(e),t.digest("hex")},i=function(e){var s=o(n),t=a(e,s);return{salt:s,hash:t}},u=function(e,s,t){return a(e,s)===t};s=e.exports={generateSaltAndHash:i,verifyPassword:u}},function(e,s){e.exports=require("crypto")}]);