!function(e){function s(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}var t={};return s.m=e,s.c=t,s.p="",s(0)}([function(e,s,t){t(1),t(13),t(14),t(19),t(15),t(11),t(17),t(10),e.exports=t(9)},function(e,s,t){"use strict";var n=t(2),r=t(3),o=t(4),a=t(5),i=t(6),u=t(7),c=t(8),d=t(9),f=parseInt(process.env.API_PORT,10)||3e3,l={origin:process.env.BASE_WEB||"*",optionsSuccessStatus:200},p=n();p.use(r.json()),p.use(r.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),p.use(o()),p.use(i({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),p.use(c(l)),p.use("/",d.index),p.use("/auth",d.auth),p.use("/email",d.email),u.Promise=global.Promise,u.connect(process.env.MONGO_URI),p.use(function(e,s,t){var n=new Error("Not Found");n.status=404,t(n)}),"development"===p.get("env")&&p.use(function(e,s,t){t.status(e.status||500),t.render("error",{message:e.message,error:e})}),p.use(function(e,s,t){t.status(e.status||500),t.render("error",{message:e.message,error:{}})}),p.listen(f,function(){a.info("App listening on port "+f+"...")})},function(e,s){e.exports=require("express")},function(e,s){e.exports=require("body-parser")},function(e,s){e.exports=require("cookie-parser")},function(e,s){e.exports=require("winston")},function(e,s){e.exports=require("express-session")},function(e,s){e.exports=require("mongoose")},function(e,s){e.exports=require("cors")},function(e,s,t){"use strict";s=e.exports={index:t(10),auth:t(11),email:t(17)}},function(e,s,t){"use strict";var n=t(2),r=n.Router();r.get("/",function(e,s){s.status(200).send("ok")}),s=e.exports=r},function(e,s,t){"use strict";var n=t(2),r=n.Router(),o=t(5),a=t(12),i=t(13),u=t(14),c=t(15);r.post("/register",function(e,s){var t=e.body.username.toLowerCase(),n=e.body.email.toLowerCase();u.findOne({email:n},function(r,i){r?s.status(500).json({message:"Error registering"}):i?s.status(400).json({message:"An account with this email already exists"}):u.findOne({username:t},function(r,i){if(r)s.status(500).json({message:"Error registering"});else if(i)s.status(400).json({message:"This username is already taken"});else{var d=e.body.password,f=c.generateSaltAndHash(d),l=new u({username:t,email:n,salt:f.salt,hash:f.hash});l.save(function(e){if(e)o.error(e),s.status(500).json({message:"Problem creating new account"});else{o.info("Succressfull created acount for: ",n);var r=a.sign({exp:Math.floor(Date.now()/1e3)+3600,data:t},process.env.MY_SECRET);s.status(201).json({token:r})}})}})})}),r.post("/login",function(e,s){var t=e.body.username&&e.body.username.toLowerCase(),n=e.body.password;u.findOne({username:t},function(e,t){if(e)s.status(400).json({message:"Incorrect username or password"});else if(t&&c.verifyPassword(n,t.salt,t.hash)){var r=a.sign({exp:Math.floor(Date.now()/1e3)+3600,data:t.username},process.env.MY_SECRET);o.info("login success"),s.status(201).json({token:r})}else s.status(401).json({message:"Incorrect username or password"})})}),r.get("/logout",function(e,s){s.redirect("/")}),r.get("/test",i(),function(e,s){s.status(200).send("ok")}),s=e.exports=r},function(e,s){e.exports=require("jsonwebtoken")},function(e,s,t){"use strict";var n=t(12),r=function(){return function(e,s,t){var r=e.headers.authorization&&e.headers.authorization.split(" ");r=r&&2===r.length&&"bearer"===r[0].toLowerCase()?r[1]:null,r?n.verify(r,process.env.MY_SECRET,function(n,r){n?s.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=r,t())}):s.status(401).json({message:"Unauthorized: No token provided"})}};s=e.exports=r},function(e,s,t){"use strict";var n=t(7),r=n.Schema,o=new r({username:String,email:String,salt:String,hash:String});s=e.exports=n.model("Account",o)},function(e,s,t){"use strict";var n=t(16),r=32,o=function(e){return n.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},a=function(e,s){var t=n.createHmac("sha512",s);return t.update(e),t.digest("hex")},i=function(e){var s=o(r),t=a(e,s);return{salt:s,hash:t}},u=function(e,s,t){return a(e,s)===t};s=e.exports={generateSaltAndHash:i,verifyPassword:u}},function(e,s){e.exports=require("crypto")},function(e,s,t){"use strict";var n=t(2),r=t(18),o=t(5),a=n.Router(),i=r.createTransport({service:"Gmail",auth:{user:process.env.SERVICE_EMAIL,pass:process.env.EMAIL_PASSWORD}}),u=function(e,s,t,n,r){var o={from:e+" <"+s+">",to:process.env.SERVICE_EMAIL,replyTo:s,subject:t,html:n};i.sendMail(o,r)};a.post("/",function(e,s){if(e.body.email&&e.body.name&&e.body.subject&&e.body.message){var t="<p>"+e.body.message+"</p>";u(e.body.name,e.body.email,e.body.subject,t,function(e,t){e?(o.error(e),s.status(500).json({message:"Unable to send email at this time."})):(o.info(t),s.status(201).json({message:"Email sent successfully"}))})}else console.log("bad email",e.body),s.status(400).json({message:"Invalid email format"})}),s=e.exports=a},function(e,s){e.exports=require("nodemailer")},function(e,s){"use strict"}]);