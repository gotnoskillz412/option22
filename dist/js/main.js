!function(e){function t(o){if(r[o])return r[o].exports;var s=r[o]={exports:{},id:o,loaded:!1};return e[o].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){r(1),r(8),r(23),r(11),r(12),r(14),r(17),r(24),r(16),r(26),r(15),r(21),r(19),e.exports=r(9)},function(e,t,r){"use strict";var o=r(2),s=r(3),n=r(4),a=r(5),i=r(6),u=r(7),c=r(8),l=r(9),f=r(15),d=r(23),p=parseInt(process.env.API_PORT,10)||3e3,m={origin:process.env.BASE_WEB||"*",credentials:!0,optionsSuccessStatus:200},g=a();g.use(o.json()),g.use(o.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),g.use(s()),g.use(i({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),g.use(n(m)),g.use("/",f.index),g.use("/auth",f.auth),g.use("/email",f.email),g.use("/accounts/:accountId/profiles",d(),c(),f.profile),u.Promise=global.Promise,u.connect(process.env.MONGO_URI),g.use(function(e,t,r){var o=new Error("Not Found");o.status=404,r(o)}),"development"===g.get("env")&&g.use(function(e,t,r){r.status(e.status||500)}),g.use(function(e,t,r){r.status(e.status||500)}),g.listen(p,function(){l.info("app.js","App listening on port "+p+"...")}),e.exports=g},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("mongoose")},function(e,t,r){"use strict";var o=r(7),s=r(9),n=r(11),a=function(){return function(e,t,r){var a=e.params.accountId;o.Types.ObjectId.isValid(a)?n.findAccount({_id:a}).then(function(o){o?(e.account=o,r()):t.status(404).send()}).catch(function(e){s.error("accountExtractor","Error checking account",{error:e}),t.status(500).json({message:"Error finding account"})}):t.status(404).send()}};e.exports=a},function(e,t,r){"use strict";var o=r(10),s=new o.Logger({transports:[new o.transports.Console({colorize:!0,level:"silly",prettyPrint:!0,timestamp:!0}),new o.transports.File({colorize:!0,filename:"logs/log.txt",level:"info",timestamp:!0})]});s.emitErrs=!1,"test"===process.env.NODE_ENV&&(s.remove(o.transports.Console),s.remove(o.transports.File)),e.exports=s},function(e,t){e.exports=require("winston")},function(e,t,r){"use strict";var o=r(12),s=r(13),n=r(9),a=r(14),i=function(e){return new Promise(function(t,r){o.findOne(e,function(e,o){e?r({step:s.mongo.steps.accountFind,message:"Error finding account",error:e}):t(o)})})},u=function(e){return new Promise(function(t,r){new o(e).save(function(o,a){o?r({step:s.mongo.steps.accountCreate,message:"Error creating account",error:o}):(n.info("mongooseHelpers","Successfully created acount for: "+e.email),t(a))})})},c=function(e){return new Promise(function(t,r){o.remove(e,function(o,a){o?r({step:s.mongo.steps.accountDelete,message:"Error deleting account",error:o}):(n.info("mongooseHelpers","Successfully removed acount for: "+e.email),t(a))})})},l=function(e){return new Promise(function(t,r){new a(e).save(function(o,a){o?r({step:s.mongo.steps.profileCreate,message:"Error creating profile",error:o}):(n.info("mongooseHelpers","Successfully created profile for: "+e.email),t(a))})})},f=function(e){return new Promise(function(t,r){a.find(e,function(e,o){e?r({step:s.mongo.steps.profileFind,message:"Error finding profiles",error:e}):t(o)})})},d=function(e){return new Promise(function(t,r){a.findOne(e,function(e,o){e?r({step:s.mongo.steps.profileFind,message:"Error finding profile",error:e}):t(o)})})},p=function(e){return new Promise(function(t,r){a.remove(e,function(o,a){o?r({step:s.mongo.steps.profileDelete,message:"Error deleting profile",error:o}):(n.info("mongooseHelpers","Successfully removed profile for: "+e.email),t(a))})})};e.exports={findAccount:i,createAccount:u,removeAccount:c,createProfile:l,findProfile:d,findAllProfiles:f,removeProfile:p}},function(e,t,r){"use strict";var o=r(7),s=o.Schema,n=new s({email:String,hash:String,salt:String,username:String});e.exports=o.model("Account",n)},function(e,t){e.exports={mongo:{steps:{accountCreate:"account-create",accountDelete:"account-delete",accountFind:"account-find",profileCreate:"profile-create",profileDelete:"profile-delete",profileUpdate:"profile-update",profileFind:"profile-find"}},blacklistPrefix:"option22-token-blacklist-"}},function(e,t,r){"use strict";var o=r(7),s=o.Schema,n=new s({accountId:s.Types.ObjectId,description:String,firstName:String,lastName:String,likes:[String],picture:String});e.exports=o.model("Profile",n)},function(e,t,r){"use strict";e.exports={index:r(16),auth:r(17),email:r(24),profile:r(26)}},function(e,t,r){"use strict";var o=r(5),s=o.Router();s.get("/",function(e,t){t.status(200).json({ok:!0})}),e.exports=s},function(e,t,r){"use strict";var o=r(5),s=r(18),n=r(8),a=r(19),i=r(13),u=r(21),c=r(9),l=r(11),f=r(23),d=o.Router();d.post("/register",function(e,t){var r=new RegExp("(?=^.{8,}$)((?=.*d)|(?=.*W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$"),o=new RegExp("^([a-zA-Z0-9_]{5,50})$"),n=e.body.firstName||null,a=e.body.lastName||null,f=e.body.username.toLowerCase(),d=e.body.email.toLowerCase(),p=null;l.findAccount({email:d}).then(function(e){return e?Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that email already exists.",error:null}):l.findAccount({username:f})}).then(function(t){if(!t){var s=e.body.password;if(!s.match(r))return Promise.reject({step:i.mongo.steps.accountCreate,message:"Password did not meet requirements."});if(!f.match(o))return Promise.reject({step:i.mongo.steps.accountCreate,message:"Username must be alphanumeric and between 5 and 50 characters."});var n=u.generateSaltAndHash(s);return l.createAccount({username:f,email:d,salt:n.salt,hash:n.hash})}return Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that username already exists.",error:null})}).then(function(e){return p=e,l.createProfile({accountId:e._id,firstName:n,lastName:a})}).then(function(e){var r=s.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:f,email:d}},process.env.MY_SECRET);t.status(201).json({token:r,profile:e,account:{email:p.email,username:p.username,_id:p._id}})}).catch(function(e){e.step===i.mongo.steps.profileCreate?l.removeAccount({email:d}).then(function(){t.status(500).json({message:e.message})}):e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),d.post("/login",function(e,t){var r=e.body.username&&e.body.username.toLowerCase(),o=e.body.password,n=null;l.findAccount({username:r}).then(function(e){e&&u.verifyPassword(o,e.salt,e.hash)?(n=e,l.findProfile({accountId:n._id}).then(function(e){var o=s.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:r,email:n.email}},process.env.MY_SECRET);c.verbose("auth","Login successful",{email:n.email}),t.status(201).json({token:o,profile:e,account:{email:n.email,username:n.username,_id:n._id}})})):t.status(401).json({message:"Incorrect username or password"})}).catch(function(e){e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),d.get("/account",f(),function(e,t){l.findAccount({username:e.decoded.data.username}).then(function(e){e?l.findProfile({accountId:e._id}).then(function(r){r?t.status(200).json({account:{email:e.email,username:e.username,_id:e._id},profile:r}):t.status(500).json({message:"Failed to find profile"})}):t.status(500).json({message:"Failed to find account"})}).catch(function(e){e.error?(c.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),d.put("/account/:accountId/password",f(),n(),function(e,t){var r=e.body.newPassword,o=e.body.currentPassword;if(e.account&&u.verifyPassword(o,e.account.salt,e.account.hash)){var s=u.generateSaltAndHash(r);e.account.salt=s.salt,e.account.hash=s.hash,e.account.save(function(e,r){e?(c.error("auth","Failed to update password",{error:e}),t.status(500).json({message:"Failed to update password."})):t.status(200).json({username:r.username,email:r.email,_id:r._id})})}else t.status(401).json({message:"Incorrect password"})}),d.get("/logout",f(),function(e,t){var r=e.headers.authorization&&e.headers.authorization.split(" ");r=r&&2===r.length&&"bearer"===r[0].toLowerCase()?r[1]:null,a.set(i.blacklistPrefix+r,!0,function(o,s){o&&(c.error("auth","Failed to logout",{error:o}),e.status(500).json({message:"Failed to log out"})),s&&setTimeout(function(){a.del(i.blacklistPrefix+r)},36e5),e.query.redirect_uri?t.redirect(302,e.query.redirect_uri):t.status(200).json({ok:!0})})}),e.exports=d},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";var o=r(20),s=new o({stdTTL:3600,checkperiod:60});e.exports=s},function(e,t){e.exports=require("node-cache")},function(e,t,r){"use strict";var o=r(22),s=function(e){return o.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},n=function(e,t){var r=o.createHmac("sha512",t);return r.update(e),r.digest("hex")},a=function(e){var t=s(32);return{salt:t,hash:n(e,t)}},i=function(e,t,r){return n(e,t)===r};e.exports={generateSaltAndHash:a,verifyPassword:i}},function(e,t){e.exports=require("crypto")},function(e,t,r){"use strict";var o=r(18),s=r(19),n=r(13),a=r(9),i=function(){return function(e,t,r){var i=e.headers.authorization&&e.headers.authorization.split(" ");i=i&&2===i.length&&"bearer"===i[0].toLowerCase()?i[1]:null,i?s.get(n.blacklistPrefix+i,function(s,n){n?t.status(401).json({message:"Old token provided"}):s?(a.error("security","Error retrieving blacklisted tokens",{error:s}),t.status(500).json({message:"Error checking old token"})):o.verify(i,process.env.MY_SECRET,function(o,s){o?t.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=s,r())})}):t.status(401).json({message:"Unauthorized: No token provided"})}};e.exports=i},function(e,t,r){"use strict";var o=r(5),s=r(25),n=r(9),a=o.Router(),i=void 0,u=s.createTransport({service:"Gmail",auth:{user:process.env.SERVICE_EMAIL,pass:process.env.EMAIL_PASSWORD}}),c=function(e,t,r,o,s){var n={from:e+" <"+t+">",to:process.env.SERVICE_EMAIL,replyTo:t,subject:r,html:o};u.sendMail(n,s)},l=function(e){e?(n.error("email","Error sending email",{error:e}),i.status(500).json({message:"Unable to send email at this time."})):(n.info("email","Email sent successfully"),i.status(201).json({message:"Email sent successfully"}))};a.post("/",function(e,t){if(i=null,e.body.email&&e.body.name&&e.body.subject&&e.body.message){var r="<p>"+e.body.message+"</p>";i=t,c(e.body.name,e.body.email,e.body.subject,r,l)}else t.status(400).json({message:"Invalid email format"})}),e.exports=a},function(e,t){e.exports=require("nodemailer")},function(e,t,r){(function(e){"use strict";var t=r(5),o=r(7),s=r(9),n=r(11),a=new t.Router;a.get("/",function(e,t){n.findAllProfiles({accountId:e.account._id}).then(function(e){t.status(200).json({total:e.length,data:e})}).catch(function(e){s.error("profile","Error getting all profiles",{error:e}),t.status(500).json({message:"Could not find profiles"})})}),a.get("/:profileId",function(e,t){o.Types.ObjectId.isValid(e.params.profileId)?n.findProfile({_id:e.params.profileId,accountId:e.account._id}).then(function(e){e?t.status(200).json(e):t.status(404).send()}).catch(function(e){s.error("profile","Error getting specified profile",{error:e}),t.status(500).json({message:"Could not find profile"})}):t.status(404).send()}),a.put("/:profileId",function(e,t){var r=e.body;n.findProfile({_id:e.params.profileId}).then(function(e){Object.keys(r).forEach(function(t){e[t]!==r[t]&&(e[t]=r[t])}),e.save(function(r,o){r?(s.error("profile","Error updating profile",{error:r}),t.status(500).json({message:"Error updating profile"})):(s.verbose("profile","Profile updated successfully",{email:e.email}),t.status(200).json(o))})}).catch(function(e){s.error("profile","Could not find profile",{error:e}),t.status(500).json({message:"Could not find profile"})})}),e=e.exports=a}).call(t,r(27)(e))},function(e,t){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}}]);