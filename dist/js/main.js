!function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){o(1),o(8),o(23),o(11),o(12),o(14),o(21),o(17),o(24),o(16),o(26),o(15),o(19),e.exports=o(9)},function(e,t,o){"use strict";var r=o(2),n=o(3),s=o(4),i=o(5),a=o(6),u=o(7),c=o(8),l=o(9),f=o(15),p=o(23),d=parseInt(process.env.API_PORT,10)||3e3,m={origin:process.env.BASE_WEB||"*",credentials:!0,optionsSuccessStatus:200},g=i();g.use(r.json()),g.use(r.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),g.use(n()),g.use(a({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),g.use(s(m)),g.use("/",f.index),g.use("/auth",f.auth),g.use("/email",f.email),g.use("/accounts/:accountId/profiles",p(),c(),f.profile),u.Promise=global.Promise,u.connect(process.env.MONGO_URI),g.use(function(e,t,o){var r=new Error("Not Found");r.status=404,o(r)}),"development"===g.get("env")&&g.use(function(e,t,o){o.status(e.status||500)}),g.use(function(e,t,o){o.status(e.status||500)}),g.listen(d,function(){l.info("app.js","App listening on port "+d+"...")}),e.exports=g},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("mongoose")},function(e,t,o){"use strict";var r=o(7),n=o(9),s=o(11),i=function(){return function(e,t,o){var i=e.params.accountId;r.Types.ObjectId.isValid(i)?s.findAccount({_id:i}).then(function(r){r?(e.account=r,o()):t.status(404).send()}).catch(function(e){n.error("accountExtractor","Error checking account",{error:e}),t.status(500).json({message:"Error finding account"})}):t.status(404).send()}};e.exports=i},function(e,t,o){"use strict";var r=o(10),n=new r.Logger({transports:[new r.transports.Console({colorize:!0,level:"silly",prettyPrint:!0,timestamp:!0}),new r.transports.File({colorize:!0,filename:"logs/log.txt",level:"info",timestamp:!0})]});n.emitErrs=!1,"test"===process.env.NODE_ENV&&(n.remove(r.transports.Console),n.remove(r.transports.File)),e.exports=n},function(e,t){e.exports=require("winston")},function(e,t,o){"use strict";var r=o(12),n=o(13),s=o(9),i=o(14),a=function(e){return new Promise(function(t,o){r.findOne(e,function(e,r){e?o({step:n.mongo.steps.accountFind,message:"Error finding account",error:e}):t(r)})})},u=function(e){return new Promise(function(t,o){new r(e).save(function(r,i){r?o({step:n.mongo.steps.accountCreate,message:"Error creating account",error:r}):(s.info("mongooseHelpers","Successfully created acount for: "+e.email),t(i))})})},c=function(e){return new Promise(function(t,o){r.remove(e,function(r,i){r?o({step:n.mongo.steps.accountDelete,message:"Error deleting account",error:r}):(s.info("mongooseHelpers","Successfully removed acount for: "+e.email),t(i))})})},l=function(e){return new Promise(function(t,o){new i(e).save(function(r,i){r?o({step:n.mongo.steps.profileCreate,message:"Error creating profile",error:r}):(s.info("mongooseHelpers","Successfully created profile for: "+e.email),t(i))})})},f=function(e){return new Promise(function(t,o){i.find(e,function(e,r){e?o({step:n.mongo.steps.profileFind,message:"Error finding profiles",error:e}):t(r)})})},p=function(e){return new Promise(function(t,o){i.findOne(e,function(e,r){e?o({step:n.mongo.steps.profileFind,message:"Error finding profile",error:e}):t(r)})})},d=function(e){return new Promise(function(t,o){i.remove(e,function(r,i){r?o({step:n.mongo.steps.profileDelete,message:"Error deleting profile",error:r}):(s.info("mongooseHelpers","Successfully removed profile for: "+e.email),t(i))})})};e.exports={findAccount:a,createAccount:u,removeAccount:c,createProfile:l,findProfile:p,findAllProfiles:f,removeProfile:d}},function(e,t,o){"use strict";var r=o(7),n=r.Schema,s=new n({username:String,email:String,salt:String,hash:String});e.exports=r.model("Account",s)},function(e,t){e.exports={mongo:{steps:{accountCreate:"account-create",accountDelete:"account-delete",accountFind:"account-find",profileCreate:"profile-create",profileDelete:"profile-delete",profileUpdate:"profile-update",profileFind:"profile-find"}},blacklistPrefix:"option22-token-blacklist-"}},function(e,t,o){"use strict";var r=o(7),n=r.Schema,s=new n({picture:String,description:String,likes:[String],accountId:n.Types.ObjectId});e.exports=r.model("Profile",s)},function(e,t,o){"use strict";e.exports={index:o(16),auth:o(17),email:o(24),profile:o(26)}},function(e,t,o){"use strict";var r=o(5),n=r.Router();n.get("/",function(e,t){t.status(200).json({ok:!0})}),e.exports=n},function(e,t,o){"use strict";var r=o(5),n=o(18),s=o(19),i=o(13),a=o(21),u=o(9),c=o(11),l=o(23),f=r.Router();f.post("/register",function(e,t){var o=e.body.username.toLowerCase(),r=e.body.email.toLowerCase(),s=null;c.findAccount({email:r}).then(function(e){return e?Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that email already exists.",error:null}):c.findAccount({username:o})}).then(function(t){if(!t){var n=e.body.password,s=a.generateSaltAndHash(n);return c.createAccount({username:o,email:r,salt:s.salt,hash:s.hash})}return Promise.reject({step:i.mongo.steps.accountCreate,message:"Account with that username already exists.",error:null})}).then(function(e){return s=e,c.createProfile({accountId:e._id})}).then(function(e){var i=n.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:o,email:r}},process.env.MY_SECRET);t.status(201).json({token:i,profile:e,account:s})}).catch(function(e){e.step===i.mongo.steps.profileCreate?c.removeAccount({email:r}).then(function(){t.status(500).json({message:e.message})}):e.error?(u.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),f.post("/login",function(e,t){var o=e.body.username&&e.body.username.toLowerCase(),r=e.body.password,s=null;c.findAccount({username:o}).then(function(e){e&&a.verifyPassword(r,e.salt,e.hash)?(s=e,c.findProfile({accountId:s._id}).then(function(e){var r=n.sign({exp:Math.floor(Date.now()/1e3)+3600,data:{username:o,email:s.email}},process.env.MY_SECRET);u.verbose("auth","Login successful",{email:s.email}),t.status(201).json({token:r,profile:e,account:s})})):t.status(401).json({message:"Incorrect username or password"})}).catch(function(e){e.error?(u.error("auth",e.message,{error:e.error,step:e.step}),t.status(500).json({message:e.message})):t.status(400).json({message:e.message})})}),f.get("/logout",l(),function(e,t){var o=e.headers.authorization&&e.headers.authorization.split(" ");o=o&&2===o.length&&"bearer"===o[0].toLowerCase()?o[1]:null,s.set(i.blacklistPrefix+o,!0,function(r,n){r&&(u.error("auth","Failed to logout",{error:r}),e.status(500).json({message:"Failed to log out"})),n&&setTimeout(function(){s.del(i.blacklistPrefix+o)},36e5),e.query.redirect_uri?t.redirect(302,e.query.redirect_uri):t.status(200).json({ok:!0})})}),e.exports=f},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,o){"use strict";var r=o(20),n=new r({stdTTL:3600,checkperiod:60});e.exports=n},function(e,t){e.exports=require("node-cache")},function(e,t,o){"use strict";var r=o(22),n=function(e){return r.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},s=function(e,t){var o=r.createHmac("sha512",t);return o.update(e),o.digest("hex")},i=function(e){var t=n(32);return{salt:t,hash:s(e,t)}},a=function(e,t,o){return s(e,t)===o};e.exports={generateSaltAndHash:i,verifyPassword:a}},function(e,t){e.exports=require("crypto")},function(e,t,o){"use strict";var r=o(18),n=o(19),s=o(13),i=o(9),a=function(){return function(e,t,o){var a=e.headers.authorization&&e.headers.authorization.split(" ");a=a&&2===a.length&&"bearer"===a[0].toLowerCase()?a[1]:null,a?n.get(s.blacklistPrefix+a,function(n,s){s?t.status(401).json({message:"Old token provided"}):n?(i.error("security","Error retrieving blacklisted tokens",{error:n}),t.status(500).json({message:"Error checking old token"})):r.verify(a,process.env.MY_SECRET,function(r,n){r?t.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=n,o())})}):t.status(401).json({message:"Unauthorized: No token provided"})}};e.exports=a},function(e,t,o){"use strict";var r=o(5),n=o(25),s=o(9),i=r.Router(),a=void 0,u=n.createTransport({service:"Gmail",auth:{user:process.env.SERVICE_EMAIL,pass:process.env.EMAIL_PASSWORD}}),c=function(e,t,o,r,n){var s={from:e+" <"+t+">",to:process.env.SERVICE_EMAIL,replyTo:t,subject:o,html:r};u.sendMail(s,n)},l=function(e){e?(s.error("email","Error sending email",{error:e}),a.status(500).json({message:"Unable to send email at this time."})):(s.info("email","Email sent successfully"),a.status(201).json({message:"Email sent successfully"}))};i.post("/",function(e,t){if(a=null,e.body.email&&e.body.name&&e.body.subject&&e.body.message){var o="<p>"+e.body.message+"</p>";a=t,c(e.body.name,e.body.email,e.body.subject,o,l)}else t.status(400).json({message:"Invalid email format"})}),e.exports=i},function(e,t){e.exports=require("nodemailer")},function(e,t,o){(function(e){"use strict";var t=o(5),r=o(7),n=o(9),s=o(11),i=new t.Router;i.get("/",function(e,t){s.findAllProfiles({accountId:e.account._id}).then(function(e){t.status(200).json({total:e.length,data:e})}).catch(function(e){n.error("profile","Error getting all profiles",{error:e}),t.status(500).json({message:"Could not find profiles"})})}),i.get("/:profileId",function(e,t){r.Types.ObjectId.isValid(e.params.profileId)?s.findProfile({_id:e.params.profileId,accountId:e.account._id}).then(function(e){e?t.status(200).json(e):t.status(404).send()}).catch(function(e){console.log("here",e),n.error("profile","Error getting specified profile",{error:e}),t.status(500).json({message:"Could not find profile"})}):t.status(404).send()}),i.put("/:profileId",function(e,t){var o=e.body;s.findProfile({_id:e.params.profileId}).then(function(e){Object.keys(o).forEach(function(t){e[t]!==o[t]&&(e[t]=o[t])}),e.save(function(o,r){o?(n.error("profile","Error updating profile",{error:o}),t.status(500).json({message:"Error updating profile"})):(n.verbose("profile","Profile updated successfully",{email:e.email}),t.status(200).json(r))})}).catch(function(e){n.error("profile","Could not find profile",{error:e}),t.status(500).json({message:"Could not find profile"})})}),e=e.exports=i}).call(t,o(27)(e))},function(e,t){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}}]);