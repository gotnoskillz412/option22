!function(e){function s(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}var t={};return s.m=e,s.c=t,s.p="",s(0)}([function(e,s,t){t(1),t(13),t(14),t(15),t(11),t(10),e.exports=t(9)},function(e,s,t){"use strict";var r=t(2),n=t(3),o=t(4),a=t(5),u=t(6),i=t(7),c=t(8),d=t(9),f=parseInt(process.env.PORT,10),p={origin:process.env.BASE_WEB,optionsSuccessStatus:200},l=function(){return function(e,s,t){return"https"!==e.headers["x-forwarded-proto"]?s.redirect(["https://",e.get("Host"),e.url].join("")):void t()}},g=r();g.use(n.json()),g.use(n.urlencoded({extended:!1,type:"*/x-www-form-urlencoded"})),g.use(o()),g.use(u({secret:process.env.MY_SECRET,resave:!1,saveUninitialized:!1})),g.use(c(p)),g.use(l()),g.use("/",d.index),g.use("/auth",d.auth),i.Promise=global.Promise,i.connect(process.env.MONGO_URI),g.use(function(e,s,t){var r=new Error("Not Found");r.status=404,t(r)}),"development"===g.get("env")&&g.use(function(e,s,t){t.status(e.status||500),t.render("error",{message:e.message,error:e})}),g.use(function(e,s,t){t.status(e.status||500),t.render("error",{message:e.message,error:{}})}),g.listen(f,function(){a.info("App listening on port "+f+"...")})},function(e,s){e.exports=require("express")},function(e,s){e.exports=require("body-parser")},function(e,s){e.exports=require("cookie-parser")},function(e,s){e.exports=require("winston")},function(e,s){e.exports=require("express-session")},function(e,s){e.exports=require("mongoose")},function(e,s){e.exports=require("cors")},function(e,s,t){"use strict";s=e.exports={index:t(10),auth:t(11)}},function(e,s,t){"use strict";var r=t(2),n=r.Router();n.get("/",function(e,s){s.status(200).send("ok")}),s=e.exports=n},function(e,s,t){"use strict";var r=t(2),n=r.Router(),o=t(5),a=t(12),u=t(13),i=t(14),c=t(15);n.post("/register",function(e,s){var t=e.body.username.toLowerCase(),r=e.body.email.toLowerCase();i.findOne({email:r},function(n,u){n?s.status(500).json({message:"Error registering"}):u?s.status(400).json({message:"An account with this email already exists"}):i.findOne({username:t},function(n,u){if(n)s.status(500).json({message:"Error registering"});else if(u)s.status(400).json({message:"This username is already taken"});else{var d=e.body.password,f=c.generateSaltAndHash(d),p=new i({username:t,email:r,salt:f.salt,hash:f.hash});p.save(function(e){if(e)o.error(e),s.status(500).json({message:"Problem creating new account"});else{o.info("Succressfull created acount for: ",r);var n=a.sign({exp:Math.floor(Date.now()/1e3)+3600,data:t},process.env.MY_SECRET);s.status(201).json({token:n})}})}})})}),n.post("/login",function(e,s){var t=e.body.username&&e.body.username.toLowerCase(),r=e.body.password;i.findOne({username:t},function(e,t){if(e)s.status(400).json({message:"Incorrect username or password"});else if(t&&c.verifyPassword(r,t.salt,t.hash)){var n=a.sign({exp:Math.floor(Date.now()/1e3)+3600,data:t.username},process.env.MY_SECRET);o.info("login success"),s.status(201).json({token:n})}else s.status(401).json({message:"Incorrect username or password"})})}),n.get("/logout",function(e,s){s.redirect("/")}),n.get("/test",u(),function(e,s){s.status(200).send("ok")}),s=e.exports=n},function(e,s){e.exports=require("jsonwebtoken")},function(e,s,t){"use strict";var r=t(12),n=function(){return function(e,s,t){var n=e.headers.authorization&&e.headers.authorization.split(" ");n=n&&2===n.length&&"bearer"===n[0].toLowerCase()?n[1]:null,n?r.verify(n,process.env.MY_SECRET,function(r,n){r?s.status(401).json({message:"Failed to authenticate the token"}):(e.decoded=n,t())}):s.status(401).json({message:"Unauthorized: No token provided"})}};s=e.exports=n},function(e,s,t){"use strict";var r=t(7),n=r.Schema,o=new n({username:String,email:String,salt:String,hash:String});s=e.exports=r.model("Account",o)},function(e,s,t){"use strict";var r=t(16),n=32,o=function(e){return r.randomBytes(Math.ceil(e/2)).toString("hex").slice(0,e)},a=function(e,s){var t=r.createHmac("sha512",s);return t.update(e),t.digest("hex")},u=function(e){var s=o(n),t=a(e,s);return{salt:s,hash:t}},i=function(e,s,t){return a(e,s)===t};s=e.exports={generateSaltAndHash:u,verifyPassword:i}},function(e,s){e.exports=require("crypto")}]);